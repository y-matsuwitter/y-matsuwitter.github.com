---
layout: post
title: オレオレGit入門
date: 2012-01-27 12:48:15.000000000 +09:00
categories:
- 未分類
tags: []
status: private
type: post
published: false
meta:
  _syntaxhighlighter_encoded: '1'
  _edit_last: '1'
author:
  login: y_matsuwitter
  email: me@yuki-matsumoto.com
  display_name: y_matsuwitter
  first_name: ''
  last_name: ''
---
<h2>Gitとは？</h2>
<p>開発において、ソースコードは毎日改変されていくと思います。 日々の改修の中で、例えばある機能に関して全く見当違いな実装をしてしまい、「あの時の状態に戻すことが出来たらなあ」なんて思いながら変更した箇所を必死に書き戻したりしてませんか？ また、人と一緒に開発していて、二人同時に同じとこを改変してしまってこんがらがったりしてませんか？</p>
<p>Gitはそういった問題を解決する素晴らしいツールです。</p>
<p>我々のプロジェクトにGitを導入することで、①日々のソースコードの状態を記録できる②人のコードと自分のコードを上手くくっつけてくれる、なんて恩恵にあずかることが出来ます。</p>
<p>こういったシステムのことをバージョン管理システムと呼びます。 今回はこのバージョン管理システムを実際に導入する手順などをご紹介します。</p>
<h2>実際の流れは？</h2>
<p>Gitは基本的に、ソースコードをリポジトリ、と呼ばれる集積庫に追加し、状態を記録し、それを人と共有する、という流れでソースコードを管理します。</p>
<h3>:一人で使う</h3>
<p>実際にGitを使ってみましょう、 まず一人で使う際のワークフローです。</p>
<p>プロジェクト開始時、プロジェクトのソースコードのあるディレクトリでgit initコマンドを実行し、リポジトリを作成します。</p>
<p>その後通常通りコーディングを始めてください。 ソースコードが出来、この状態を記録したいと思ったら、git addコマンドを発行しましょう。</p>
<p>[shell]git add リポジトリに記録したいファイル・ディレクトリ名[/shell]</p>
<p>このコマンドで、記録の準備ができます。 この動作をステージと呼びます。</p>
<p>記録したいファイルをすべてステージしたら、git commitコマンドを実行しましょう。</p>
<p>[shell]git commit[/shell]</p>
<p>このコマンドによって、あなたがステージしたソースコードを実際にリポジトリに記録します。 この時、大抵はvimが起動し、メッセージ記入を要求されます。 定石としては、１行目にタイトル、２行目を空行にして、３行目から細かなメッセージを入力します。 そして通常通り保存して終了すると、そのメッセージと共に、ステージしたファイルの状態を記録します。</p>
<p>この流れの繰り返しで、指定したファイルの前の状態との変更を随時記録してゆきます。</p>
<p>実際に昔の状態に戻したくなったらどうしたら良いでしょうか。</p>
<p>このときはgit logコマンドなどを実行し、戻したい状態のcommitから始まる行の英数字をコピーしてください。</p>
<p>[shell]git reset --hard さっきの英数字[/shell]</p>
<p>以上でそのときの状態に戻すことができます。</p>
<p>もしくは、現在の状態から幾つ前に戻りたいか決まっている場合には、</p>
<p>[shell]git reset --hard HEAD^[/shell]</p>
<p>などでもどることが出来ます。</p>
<p>詳しくはこちらを</p>
<p><a title="http://labs.timedia.co.jp/2011/08/git-undo-999.html" href="http://labs.timedia.co.jp/2011/08/git-undo-999.html">http://labs.timedia.co.jp/2011/08/git-undo-999.html</a></p>
<p>この一つ一つのソースコードの状態をバージョンとよび、またソースコードのバージョンの連なりをブランチといいます。</p>
<p>ブランチは枝という意味で、その名のとおり、枝分かれさせることが出来ます。</p>
<p>つまり、一つのバージョンからいくつかのバージョンに分岐できます、 通常のバージョンはmasterと呼ばれるブランチに記録されます。</p>
<p>では試しに新しいブランチを作ってみましょう</p>
<p>[shell]git branch test[/shell]</p>
<p>以上でtestという名前のブランチが出来上がります。</p>
<p>[shell]git checkout test[/shell]</p>
<p>以上のコマンドで現在使用しているリポジトリをtestブランチに切り替えることが出来ます。 ブランチを上手く活用することで、一つのバージョンから複数の機能の実装を独立に含めることが出来ます。 また、いくつか独立に実装をすすめたブランチを統合することも出来ます。 これをマージといいます。</p>
<p>例えばブランチAにブランチBの変更を統合するときには、使用しているブランチをAに切り替えた上で</p>
<p>[shell]git merge B[/shell]</p>
<p>としましょう。 これでAの最新のバージョンにBブランチの変更がマージされます。</p>
<p>以上の工程を上手く活用することで、アプリケーション開発時に、バージョンの管理、また複数の機能の同時実装などがスムーズに行えるでしょう。</p>
<p>基本は以下のコマンドなので覚えてしまいましょう。</p>
<p>[shell]<br />
git add &lt;追加したいファイル&gt;</p>
<p>git commit</p>
<p>git reset</p>
<p>git branch</p>
<p>git checkout</p>
<p>git merge<br />
[/shell]</p>
<h3>:複数人で使う</h3>
<p>つぎは複数人で一つのプロジェクトを進める場合に、他人のソースコードへの変更を共有する方法になります。</p>
<p>複数人で開発するときは、全員がsshで接続できるサーバーに、少なくとも全員のサーバー上のユーザーがアクセスできるディレクトリに共有リポジトリというものを作成します。</p>
<p>定石として、共有するディレクトリにはプロジェクト名.gitといった名前を使います。</p>
<p>[shell]<br />
mkdir hoge.git</p>
<p>cd hoge.git<br />
[/shell]</p>
<p>そしてそのディレクトリにおいて、共有用のgitの初期化をします</p>
<p>[shell]<br />
git init --bare --shared<br />
[/shell]</p>
<p>このコマンドによって、全員が変更を反映するためのリポジトリが作成されます。 その後ローカルに於いて、プロジェクトフォルダ内で</p>
<p>[shell]<br />
git remote add origin &amp;lt;ssh上のさっきのディレクトリ&amp;gt;<br />
[/shell]</p>
<p>というコマンドでgitに共有リポジトリの場所を認識させます。 全員がこの共有リポジトリに変更を反映し、またその共有リポジトリの状態をローカルに反映する、という作業を通じて、ソースコードを上手くくっつけることが出来ます。</p>
<p>その実際の作業手順になります。 まずサーバーの共有リポジトリの状態を取得してみましょう。</p>
<p>[shell]<br />
git fetch oigin master<br />
[/shell]</p>
<p>このコマンドで共有リポジトリのmasterブランチの状態をローカルのリポジトリに、取得します。 この状態では共有リポジトリの状態が、ローカルの特別なブランチの一状態として記録されております。 実際にこの共有リポジトリの状態をローカルのブランチと合体したい場合は、先に述べたとおり、mergeします。</p>
<p>[shell]<br />
git merge origin/master<br />
[/shell]</p>
<p>fetchとmergeを同時にこなしてくれるpullコマンドというものも存在します。</p>
<p>[shell]<br />
git pull origin master<br />
[/shell]</p>
<p>次にローカルの状態を共有リポジトリに反映する方法です。 いつもどおり、commitなどして状態の変更が記録されたあと、以下のコマンドを実行します。</p>
<p>[shell]<br />
git push origin master<br />
[/shell]</p>
<p>このコマンドがエラーを出したときは、まず共有リポジトリの状態をローカルに反映しましょう。</p>
<p>以上の流れで、リモートのリポジトリと状態を共有していきます。</p>
